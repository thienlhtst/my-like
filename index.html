<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link
      href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap"
      rel="stylesheet"
    />

    <title>M·ªôt ch√∫t h√†o h·ª©ng</title>
    <style>
      :root {
        --W: 700px;
        --H: 520px;
        --edge: 3px;
        --angle: -180deg;
        --lh: 32px;
        --rule: 1px;
        --rule-color: rgba(0, 0, 0, 0.1);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #fff6d9;
        user-select: none;
        overflow: hidden;
        font-family: "Noto Serif", "Times New Roman", Georgia, serif;
      }

      /* ====== LAYER HOA R∆†I (n·∫±m sau b√¨ th∆∞) ====== */
      .flower-layer {
        position: fixed;
        inset: 0;
        z-index: 0;
        pointer-events: none;
        overflow: hidden;
      }

      .petal-wrap {
        position: fixed;
        top: -10vh;

        animation: fall var(--dur, 12s) linear forwards;
        will-change: transform;
      }

      .petal {
        display: block;
        animation: sway var(--sway, 3s) ease-in-out infinite alternate;
        will-change: transform;
        filter: drop-shadow(0 2px 1px rgba(0, 0, 0, 0.12));
      }
      .petal-img {
        width: var(--size, 40px);
        height: auto;
        display: block;
        pointer-events: none;
      }

      @keyframes fall {
        to {
          transform: translateY(110vh);
        }
      }

      @keyframes sway {
        from {
          transform: translateX(calc(var(--amp, 24px) * -1))
            rotate(var(--rot, 0deg));
        }

        to {
          transform: translateX(var(--amp, 24px))
            rotate(calc(var(--rot, 0deg) + 45deg));
        }
      }

      /* ====== B√å TH∆Ø 3D ====== */
      .letter {
        position: relative;
        width: var(--W);
        height: var(--H);
        perspective: 1400px;
        z-index: 10;
      }

      .page {
        position: absolute;
        top: 0;
        left: 0;
        width: 50%;
        height: 100%;
        display: flex;
        align-items: stretch;
        justify-content: center;
        padding: 0;
      }

      /* Trang tr√°i (b√™n trong c√≥ gi·∫•y k·∫ª d√≤ng) */
      .left {
        background: #fff;
        border: 1px solid #cfcfcf;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        z-index: 1;
        overflow: hidden;
      }

      .spine {
        position: absolute;
        inset: 0 auto 0 50%;
        width: 2px;
        background: rgba(0, 0, 0, 0.08);
        transform: translateX(-50%);
        z-index: 0;
      }

      /* B√≥ng ƒë·ªông RI√äNG c·ªßa trang ph·∫£i */
      .right-shadow {
        position: absolute;
        top: 0;
        left: 50%;
        width: 50%;
        height: 100%;
        z-index: 2;
        pointer-events: none;
        filter: drop-shadow(
          calc(((-1 * (var(--angle))) / 180) * 10px) 0 14px rgba(0, 0, 0, 0.28)
        );
      }

      .right {
        position: absolute;
        top: 0;
        left: 50%;
        width: 50%;
        height: 100%;
        transform-style: preserve-3d;
        transform-origin: left center;
        transform: rotateY(-180deg);
        transition: transform 0.35s ease;
        z-index: 3;
        background: transparent;
        border: none;
        box-shadow: none;
      }

      .face {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: stretch;
        justify-content: stretch;
        padding: 0;
        background: #fff;
        border: 1px solid #cfcfcf;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.18);
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        overflow: hidden;
      }

      /* M·∫∂T TR∆Ø·ªöC TRANG PH·∫¢I = B√åA -> ƒê·∫¨M H∆†N */
      .front {
        transform: rotateY(0deg) translateZ(0.01px);
        background: #f0e0b6;
        /* ƒë·∫≠m h∆°n m·ªôt x√≠u */
        border-color: #c8b88f;
      }

      /* M·∫∂T SAU TRANG PH·∫¢I = M·∫∂T N·ªòI DUNG B√äN TRONG */
      .back {
        transform: rotateY(180deg) translateZ(0.01px);
        background: #fdfdfd;
      }

      .right::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: var(--edge);
        height: 100%;
        background: linear-gradient(180deg, #dcdcdc, #f3f3f3);
        transform-origin: left center;
        transform: rotateY(90deg) translateZ(0.5px);
        box-shadow: 0 0 6px rgba(0, 0, 0, 0.15);
      }

      .fore-edge {
        position: absolute;
        top: 0;
        right: 0;
        width: var(--edge);
        height: 100%;
        background: linear-gradient(180deg, #e9e9e9, #fafafa);
        transform-origin: right center;
        transform: rotateY(-90deg) translateZ(0.5px);
        box-shadow: 0 0 6px rgba(0, 0, 0, 0.12);
      }

      .drag-layer {
        position: absolute;
        inset: 0;
        z-index: 15;
        cursor: grab;
        touch-action: none;
      }

      .dragging .drag-layer {
        cursor: grabbing;
      }

      .dragging .right {
        transition: none;
      }

      /* ====== GI·∫§Y K·∫∫ D√íNG (ruled) B√äN TRONG ====== */
      .ruled {
        position: relative;
        font-family: "Patrick Hand", cursive;
        flex: 1;
        padding: calc(var(--lh) * 1) 26px calc(var(--lh) * 1) 26px;
        /* c√¢n theo --lh */
        line-height: var(--lh);
        background-color: #fff;
overflow-y: auto; 
  
  /* 2. Gi√∫p cu·ªôn m∆∞·ª£t tr√™n iPhone/iPad */
  -webkit-overflow-scrolling: touch;
        /* CH·ªà v·∫°ch ngang */
        background-image: linear-gradient(
          180deg,
          var(--rule-color) var(--rule),
          transparent var(--rule)
        );
        background-size: 100% var(--lh);
        background-position: 0 0;
        background-repeat: repeat;
        scrollbar-width: none; 

  /* 3. ·∫®n scrollbar tr√™n Internet Explorer v√† Edge c≈© */
  -ms-overflow-style: none;
      }
.ruled::-webkit-scrollbar {
  display: none;
}
      .ruled p {
        margin: 0 0 8px;
      }

      .ruled h2 {
        margin: 0 0 10px;
        font-size: 22px;
        text-align: center;
        letter-spacing: 1px;
      }

      /* Kh·ªëi th∆∞ b√™n tr√°i */
      .letter-left-inner {
        width: 100%;
      }

      .salute {
        margin-bottom: 8px;
        font-weight: 600;
      }

      .content {
        white-space: pre-line;
      }

      /* Kh·ªëi k·∫ø ho·∫°ch b√™n ph·∫£i (m·∫∑t sau) */
      .plans {
        width: 100%;
      }

      .plan-title {
        margin: 0 0 12px;
        font-size: 22px;
        text-align: center;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .plan-block {
        margin: 8px 0 12px;
      }

      .plan-block > .plan-head {
        font-weight: 700;
      }

      .plan-block ul {
        margin: 6px 0 0 18px;
        padding: 0;
      }

      .plan-block li {
        margin: 2px 0;
      }

      .group {
        margin: 14px 0 6px;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .group legend {
        font-weight: 700;
        margin-bottom: 2px;
      }

      .radio-row {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
      }

      .radio-row label {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
      }

      .note {
        margin-top: 6px;
      }

      input[type="text"] {
        width: 100%;
        max-width: 100%;
        height: 34px;
        border: 1px solid #cfcfcf;
        border-radius: 6px;
        padding: 6px 10px;
        font-family: inherit;
        background: #fff;
      }

      .actions {
        margin-top: 16px;
        display: flex;
        justify-content: flex-start;
        gap: 10px;
      }

      button {
        appearance: none;
        border: none;
        border-radius: 10px;
        padding: 10px 16px;
        font-weight: 700;
        background: #ef5a8a;
        color: #fff;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(239, 90, 138, 0.35);
        transition: 0.2s;
      }

      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 14px rgba(239, 90, 138, 0.45);
      }

      button:active {
        transform: translateY(0);
      }

      .btn-cancel {
        position: relative;
        background: #bbb;
        /* m√†u x√°m cho n√∫t t·ª´ ch·ªëi */
      }

      .btn-cancel::after {
        content: "TA ch·∫Øc ch∆∞a huhu ü•∫";
        position: absolute;
        left: 50%;
        top: -40px;
        /* hi·ªán ·ªü tr√™n n√∫t */
        transform: translateX(-50%);
        background: #fff6d9;
        color: #333;
        padding: 6px 10px;
        border-radius: 8px;
        font-size: 14px;
        white-space: nowrap;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.25s;
      }

      .btn-cancel:hover::after {
        opacity: 1;
      }

      /* responsive nh·∫π */
      @media (max-width: 820px) {
        :root {
          --W: 92vw;
          --H: 64vh;
        }

        .ruled {
          padding: 22px 18px 22px 22px;
          line-height: 24px;
        }
      }
    </style>
  </head>

  <body>
    <!-- N·ªÄN HOA R∆†I -->
    <div class="flower-layer" id="flowerLayer" aria-hidden="true"></div>

    <!-- L√Å TH∆Ø -->
    <div class="letter" id="letter">
      <div class="spine" aria-hidden="true"></div>

      <!-- TRANG TR√ÅI: N·ªòI DUNG L√Å TH∆Ø -->
      <div class="page left">
        <div class="ruled letter-left-inner">
          <p class="salute">Dear <span id="ten">Tr√¢m Anh</span>,</p>
          <p class="content">
            Ch√∫ng ta m·ªõi quen nhau c≈©ng l√¢u, nh∆∞ng Thi·ªán th·∫•y ch∆∞a c√≥ d·ªãp n√†o ƒë·ªÉ m√¨nh th·∫≠t s·ª± ·ªü s√†i g√≤n m√† h·∫πn nhau, n√™n Thi·ªán mu·ªën m·ªùi Tr√¢m Anh v√†o ng√†y <strong>Th·ª© b·∫£y, ng√†y 03/01/2026</strong>.
          Mong r·∫±ng Thi·ªán c√≥ th·ªÉ bi·∫øt nhi·ªÅu h∆°n v·ªÅ Tr√¢m Anh h∆°n.
          </p>
        </div>
      </div>

      <div class="right-shadow" id="rightShadow" aria-hidden="true"></div>

      <!-- TRANG PH·∫¢I: M·∫∂T TR∆Ø·ªöC = B√åA (ƒë·∫≠m h∆°n) -->
      <div class="right" id="right">
        <!-- M·∫∑t trong: K·∫æ HO·∫†CH -->
        <div class="face front">
          <form class="ruled plans" id="planForm">
            <h2 class="plan-title">K·∫ø ho·∫°ch</h2>

            <div class="plan-block">
              <div class="plan-head">- K·∫ø ho·∫°ch 1 (ch∆°i chi·ªÅuu)</div>
              <ul>
                <li>ƒëi c√† h√™</li>
                <li>ƒëi ƒÉn </li>
                <li>ƒëi d·∫°o </li>
              </ul>
            </div>

            <div class="plan-block">
              <div class="plan-head">- K·∫ø ho·∫°ch 2 (ch∆°i t·ªëiiii)</div>
              <ul>
                <li>ƒëi ƒÉn </li>
                <li>ƒëi d·∫°o</li>
              </ul>
            </div>

            <!-- <fieldset class="group">
              <legend>Ch·ªçn c√°ch di chuy·ªÉn</legend>
              <div class="radio-row">
                <label
                  ><input type="radio" name="ride" value="self" required /> em
                  t·ª± ƒëi cho tho·∫£i m√°i</label
                >
                <label
                  ><input type="radio" name="ride" value="pickup" /> ƒë·ªÉ anh r∆∞·ªõc
                  cho ti·ªán</label
                >
              </div>
            </fieldset> -->

            <fieldset class="group">
              <legend>Ch·ªçn k·∫ø ho·∫°ch</legend>
              <div class="radio-row">
                <label
                  ><input type="radio" name="plan" value="1" required /> k·∫ø
                  ho·∫°ch 1</label
                >
                <label
                  ><input type="radio" name="plan" value="2" /> k·∫ø ho·∫°ch
                  2</label
                >
                <label
                  ><input type="radio" name="plan" value="3" id="plan3" /> k·∫ø
                  ho·∫°ch 3</label
                >
              </div>
              <div class="note" id="plan3Note" style="display: none">
                <input
                  type="text"
                  name="plan3_text"
                  placeholder="M√¥ t·∫£ k·∫ø ho·∫°ch 3 (TA mu·ªën ƒëi ƒë√¢u / l√†m g√¨?)"
                />
              </div>
            </fieldset>

            <div class="actions">
              <button type="submit" value="accept">G·ª≠i tr·∫£ l·ªùi üíå</button>
              <button type="submit" value="decline" class="btn-cancel">
                Th√¥i TA kh√¥ng ƒëi ƒë√¢u
              </button>
            </div>
          </form>
        </div>

        <!-- M·∫∑t ngo√†i: B√åA -->
        <div class="face back">
          <div
            class="ruled"
            style="
              display: flex;
              align-items: center;
              justify-content: center;
              background: #f0e0b6;
            "
          >
            <div style="text-align: center">
              <p style="margin-top: 8px; opacity: 0.8">
                K√©o sang ph·∫£i ƒë·ªÉ m·ªü üíå
              </p>
            </div>
          </div>
        </div>

        <div class="fore-edge"></div>
      </div>

      <div class="drag-layer" id="dragLayer" aria-label="K√©o ƒë·ªÉ m·ªü/ƒë√≥ng"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
      // KH·ªûI T·∫†O 1 L·∫¶N duy nh·∫•t, tr∆∞·ªõc khi g·ªçi send()
      emailjs.init({ publicKey: "LL1Ou-ntdGKGm14Eh" }); // public key c·ªßa b·∫°n
    </script>
    <script>
      (() => {
        const openSfx = new Audio("./music.mp3"); // ƒë·ªïi ƒë∆∞·ªùng d·∫´n n·∫øu c·∫ßn
        openSfx.preload = "auto";
        openSfx.volume = 0.6;

        // M·ªìi quy·ªÅn ph√°t √¢m thanh sau t∆∞∆°ng t√°c ƒë·∫ßu ti√™n c·ªßa user
        let audioPrimed = false;
        const primeOnce = () => {
          if (audioPrimed) return;
          audioPrimed = true;
          // th·ª≠ play r·ªìi pause ngay ƒë·ªÉ "unlock"
          openSfx
            .play()
            .then(() => {
              openSfx.pause();
              openSfx.currentTime = 0;
            })
            .catch(() => {
              /* ignore */
            });
        };
        window.addEventListener("pointerdown", primeOnce, { once: true });
        window.addEventListener("touchstart", primeOnce, { once: true });

        /* ====== LOGIC HOA R∆†I ====== */
        const layer = document.getElementById("flowerLayer");

        // tu·ª≥ ch·ªânh
        const PETALS_PER_SEC = 6;
        const SIZE_MIN = 20,
          SIZE_MAX = 28;
        const DUR_MIN = 9,
          DUR_MAX = 16;
        const SWAY_MIN = 2.2,
          SWAY_MAX = 4.2;
        const AMP_MIN = 18,
          AMP_MAX = 40;

        function rand(a, b) {
          return a + Math.random() * (b - a);
        }
        function spawnPetal() {
          const wrap = document.createElement("span");
          const petal = document.createElement("span");
          wrap.className = "petal-wrap";
          petal.className = "petal";
          petal.innerHTML = `<img src="./cheery.svg" alt="petal" class="petal-img">`;

          const xvw = rand(0, 100);
          const size = rand(SIZE_MIN, SIZE_MAX);
          const dur = rand(DUR_MIN, DUR_MAX);
          const sway = rand(SWAY_MIN, SWAY_MAX);
          const amp = rand(AMP_MIN, AMP_MAX);
          const rot = rand(-25, 25);

          wrap.style.left = `calc(${xvw}vw - ${size / 2}px)`;
          wrap.style.setProperty("--dur", `${dur}s`);
          petal.style.setProperty("--size", `${size}px`);
          petal.style.setProperty("--sway", `${sway}s`);
          petal.style.setProperty("--amp", `${amp}px`);
          petal.style.setProperty("--rot", `${rot}deg`);

          wrap.appendChild(petal);
          layer.appendChild(wrap);
          wrap.addEventListener("animationend", () => wrap.remove());
        }

        let timer;
        function startSnow() {
          const interval = 1000 / PETALS_PER_SEC;
          stopSnow();
          timer = setInterval(spawnPetal, interval);
        }
        function stopSnow() {
          if (timer) clearInterval(timer);
        }

        document.addEventListener("visibilitychange", () => {
          if (document.hidden) stopSnow();
          else startSnow();
        });
        startSnow();

        /* ====== LOGIC K√âO L√Å TH∆Ø ====== */
        const letter = document.getElementById("letter");
        const right = document.getElementById("right");
        const rightShadow = document.getElementById("rightShadow");
        const dragLayer = document.getElementById("dragLayer");

        let isDragging = false,
          startX = 0,
          startAngle = -180,
          currentAngle = -180,
          suppressClick = 0;
        const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
        const X = (e) =>
          e.touches?.[0]?.clientX ??
          e.changedTouches?.[0]?.clientX ??
          e.clientX ??
          0;

        const setAngle = (deg) => {
          currentAngle = clamp(deg, -180, 10);
          right.style.transform = `rotateY(${currentAngle}deg)`;
          rightShadow.style.setProperty("--angle", currentAngle + "deg");
          const isOpen = currentAngle > -10;
          dragLayer.style.pointerEvents = isOpen ? "none" : "auto";
        };

        const snap = () => {
          right.style.transition = "transform .45s ease";

          // m·ªü n·∫øu k√©o qu√° -120¬∞, ƒë√≥ng n·∫øu kh√¥ng
          const targetAngle = currentAngle > -120 ? 0 : -180;

          // n·∫øu ƒëang ƒë√≥ng (<= -120) m√† s·∫Øp m·ªü (0¬∞), ch∆°i √¢m thanh
          const wasClosed = startAngle <= -120;
          const willOpen = targetAngle === 0;

          setAngle(targetAngle);

          if (willOpen && wasClosed) {
            try {
              openSfx.currentTime = 0;
              openSfx.play();
            } catch (e) {
              /* b·ªã ch·∫∑n th√¨ b·ªè qua */
            }
          }
        };

        const down = (e) => {
          isDragging = true;
          letter.classList.add("dragging");
          right.style.transition = "none";
          startX = X(e);
          startAngle = currentAngle;
          dragLayer.setPointerCapture?.(e.pointerId);
        };
        const move = (e) => {
          if (!isDragging) return;
          const dx = X(e) - startX;
          const w = right.offsetWidth || letter.offsetWidth / 2 || 1;
          setAngle(startAngle + (dx / w) * 180);
        };
        const up = (e) => {
          if (!isDragging) return;
          isDragging = false;
          letter.classList.remove("dragging");
          dragLayer.releasePointerCapture?.(e.pointerId);
          snap();
          suppressClick = Date.now() + 250;
        };
        const click = () => {
          if (Date.now() < suppressClick) return;
          const nearClosed = currentAngle < -170;
          const nearOpen = currentAngle > -10;
          if (!nearClosed && !nearOpen) return;
          right.style.transition = "transform .45s ease";
          setAngle(nearClosed ? 0 : -180);
        };

        dragLayer.addEventListener("pointerdown", down);
        window.addEventListener("pointermove", move);
        window.addEventListener("pointerup", up);
        window.addEventListener("pointercancel", up);
        dragLayer.addEventListener("click", click);

        // touch fallback
        dragLayer.addEventListener(
          "touchstart",
          (e) => {
            e.preventDefault();
            down(e);
          },
          { passive: false }
        );
        dragLayer.addEventListener(
          "touchmove",
          (e) => {
            e.preventDefault();
            move(e);
          },
          { passive: false }
        );
        dragLayer.addEventListener(
          "touchend",
          (e) => {
            e.preventDefault();
            up(e);
          },
          { passive: false }
        );
        dragLayer.addEventListener(
          "touchcancel",
          (e) => {
            e.preventDefault();
            up(e);
          },
          { passive: false }
        );

        setAngle(-180);

        /* ====== FORM: hi·ªán input khi ch·ªçn k·∫ø ho·∫°ch 3 + submit ====== */
        const plan3Radio = document.getElementById("plan3");
        const plan3Note = document.getElementById("plan3Note");
        const planForm = document.getElementById("planForm");

        planForm.addEventListener("change", (e) => {
          const isPlan3 = plan3Radio?.checked;
          plan3Note.style.display = isPlan3 ? "block" : "none";
        });

        planForm.addEventListener("submit", (e) => {
          e.preventDefault();

          const btn = e.submitter; // n√∫t ƒë∆∞·ª£c b·∫•m
          const action = btn?.value; // l·∫•y value trong n√∫t

          const data = new FormData(planForm);
          const ride = data.get("ride");
          const plan = data.get("plan");
          const extra = data.get("plan3_text") || "";

          if (action === "accept") {
            // N·ªôi dung th∆∞
            const message = `ƒê√£ nh·∫≠n ph·∫£n h·ªìi:
- C√°ch di chuy·ªÉn: ${ride === "pickup" ? "Anh r∆∞·ªõc" : "Em t·ª± ƒëi"}
- K·∫ø ho·∫°ch: ${plan}
${plan === "3" ? "- Ghi ch√∫ K·∫ø ho·∫°ch 3: " + extra : ""}`;

            // G·ªçi EmailJS
            emailjs
              .send(
                "Sendmail_043", // service_id
                "template_f5tdn6u", // template_id
                {
                  from_name: "Qu·ª≥nh Nh∆∞",
                  from_email: "quynhnhu@example.com", // b·∫°n c√≥ th·ªÉ thay b·∫±ng input t·ª´ user
                  subject: "Ph·∫£n h·ªìi k·∫ø ho·∫°ch h·∫πn",
                  message: message,
                },
                "LL1Ou-ntdGKGm14Eh" // public key
              )
              .then(() => {
                alert("ƒê√£ g·ª≠i ph·∫£n h·ªìi th√†nh c√¥ng üíå");
              })
              .catch((err) => {
                console.error("EmailJS error:", err);
                alert("C√≥ l·ªói khi g·ª≠i email, vui l√≤ng th·ª≠ l·∫°i.");
              });
          } else if (action === "decline") {
            alert("TA kh√¥ng ƒëi... üò¢ TA ch·∫Øc ch∆∞a ƒë√≥ huhu ü•∫");
          }
        });
      })();
    </script>
  </body>
</html>
